<!DOCTYPE html>
<html>
<head>
	<title>Test de boites</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<link href="boites.css" media="screen" rel="Stylesheet" type="text/css" />
	<script type="text/javascript" src="jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="boites.js"></script>
</head>
<body>
	<script type="text/javascript">
Array.prototype.remove = function(elem) {
    var match = -1;

    while( (match = this.indexOf(elem)) > -1 ) {
        this.splice(match, 1);
    }
};

function get_random_color() {
	var letters = '0123456789ABCDEF';
	var color = '#';
	for (var i = 0; i < 6; i++ ) {
		color += letters[Math.round(Math.random() * 15)];
	}
	return color;
}


$(document).ready(function() {
	boiboites = new Boxes_layout(document.body, Boxes_DIRECTIONS.VERTICAL);
	function bb() {
		var box = boiboites.createBox();
		box.front.appendChild(document.createTextNode('vive les canards'));

		var visualizations = document.createElement('div');
		visualizations.className = 'visualizations';
		var visualizations_h = document.createElement('h3');
		visualizations_h.appendChild(document.createTextNode('Visualisations'));
		visualizations.appendChild(visualizations_h);
		visualizations.appendChild(document.createTextNode('type de visualisation'));
		box.back.appendChild(visualizations);

		var options = document.createElement('div');
		options.className = 'options';
		var options_h = document.createElement('h3');
		options_h.appendChild(document.createTextNode('Configuration'));
		options.appendChild(options_h);
		options.appendChild(document.createTextNode('ceci est un test'));
		box.back.appendChild(options);

		var data = document.createElement('div');
		data.className = 'data';
		var data_h = document.createElement('h3');
		data_h.appendChild(document.createTextNode('Données'));
		data.appendChild(data_h);
		data.appendChild(document.createTextNode('liste des données'));
		box.back.appendChild(data);

		var color = get_random_color();
		box.front.style.background = color;
		box.box.id = "box_"+color.slice(1); 
		return box.box;
	}
	canvaas = bb();
	boiboites.addBox(canvaas);

	lapin = new Boxes_container(Boxes_DIRECTIONS.HORIZONTAL);
	boiboites.addBox(lapin);
	boiboites.addBox(bb(), lapin);
	boiboites.addBox(bb(), lapin);
	canard = new Boxes_container(Boxes_DIRECTIONS.VERTICAL);
	boiboites.addBox(canard, lapin);
	boiboites.addBox(bb(), canard);
	boiboites.addBox(bb(), canard);
	boiboites.addBox(bb(), canard);
	setTimeout(function(){boiboites.equilibrate();}, 1);
	/*setTimeout(function()
	{
		lapin = boiboites.newBoite(Boxes_DIRECTIONS.HORIZONTAL);
		bb(lapin);
		bb(lapin);
		setTimeout(function()
		{
			canard = lapin.newBoite(Boxes_DIRECTIONS.VERTICAL);
			bb(canard);
			bb(canard);
			bb(canard);
		}, 1);
	}, 1);
	
	setTimeout(function() {boiboites.dessinerDisposition();}, 200);
*/
	//didiv = bb();

	jbouton = $("#bouton_boite");

	var drag_start_x = 0;
	var drag_start_y = 0;

	var drag = function(e){
		jbouton.css({
			top: (e.pageY-drag_start_y)+'px', 
			left: (e.pageX-drag_start_x)+'px'
		});
	};

	jbouton.mousedown(function(e) {
		boiboites.drag_enabled = false;
		drag_start_x = e.offsetX;
		drag_start_y = e.offsetY;
		var boite = bb();
		boite.style.display = 'none';
		boiboites.dragged_box = boite;
		document.body.addEventListener('mousemove', drag);
	});

	var stop_drag = function() {
		boiboites.drag_enabled = true;
		//boiboites.dragged_box = null;
		document.body.removeEventListener('mousemove', drag);
		jbouton.animate({
			top:'0px',
			left: '0px'}, 250);
	};
	jbouton.mouseup(stop_drag);
	//jbouton.mouseout(stop_drag);
	//window.setInterval(bb, 500);

	jbouton.hide();

	$('#flip').click(function() {

		jboxes = $('.boxdiv');
		jboxes.addClass('flipped_animation');

		setTimeout(function() {
			jboxes.removeClass('flipped_animation');
			boiboites.toggleFrontMode();
		}, 600);
		if (boiboites.front)
			jbouton.show();
		else
			jbouton.hide();
	});

	$('#flip').click();
});
	</script>
<div id="bouton_boite" style="display:none;">Nouvelle Boite Magique</div>
<div id="flip">Flip!</div>
</body>
</html>
